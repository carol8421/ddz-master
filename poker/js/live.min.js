var v={objectId:getQueryString("videoId"),status:getQueryString("status"),gifts_list:{}};var resizeEvt="orientationchange" in window?"orientationchange":"resize";var clickEvt=("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch?"touchend":"click";var _czc=window._czc||new Array();var Dasheng=window.Dasheng||null;var websiteHost=window.location.hostname;var isTest=websiteHost.match(/test/);var x5=false;var ua=navigator.userAgent;var uaArray=ua.split(" ");var isQQBrowser=false;var isWx=ua.toLowerCase().match(/MicroMessenger/i)=="micromessenger";for(var i=0;i<uaArray.length;i++){if(uaArray[i].indexOf("TBS/")>-1){isQQBrowser=true;if(parseFloat(uaArray[i].substring(4))>36849){x5=true}}else{if(uaArray[i].indexOf("MQQBrowser")>-1){isQQBrowser=true;if(parseFloat(uaArray[i].substring(11))>7.1){x5=true}}}}var websiteHost=window.location.hostname;var isDist=websiteHost.match(/web.ddz.dasheng.tv/);var getScript=function(a,c){var b=document.createElement("script");b.src=a;if(b.readyState){b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete"){b.onreadystatechange=null;if(c){c()}}}}else{b.onload=function(){if(c){c()}}}document.getElementsByTagName("body").item(0).appendChild(b)};var tipsTime=0;var tipsIn=false;var tips=function(c){tipsTime=0;var b=document.getElementsByClassName("msg-tips")[0];b.innerHTML=c;b.classList.add("show");var a=setInterval(function(){tipsTime+=33;if(tipsTime>=1300){clearInterval(a);b.classList.remove("show");tipsIn=false}},33)};(function(){window.GlobalFun={weibo:navigator.userAgent.toLowerCase().match(/WeiBo/i)=="weibo",docWidth:function(){return document.documentElement.clientWidth||document.body.clientWidth},docHeight:function(){return document.documentElement.clientHeight||document.body.clientHeight},screenWidth:function(){return window.screen.width},screenHeight:function(){return window.screen.height},orientation:function(){if(window.orientation===90||window.orientation===-90){return"landscape"}else{if(window.orientation===0||window.orientation===0){return"portrait"}else{return null}}},hasClass:function(b,a){return !!b.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))},toggleClass:function(b,a){if(GlobalFun.hasClass(b,a)){b.classList.remove(a)}else{b.classList.add(a)}},android:(navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Linux")>-1),removeClass:function(b,a){if(window.GlobalFun.hasClass(b,a)){b.className=b.className.replace(new RegExp("(\\s|^)"+a+"(\\s|$)")," ")}},whichTransitionEvent:function(c){var b=document.createElement("fakeelement");var d=c==="animation"?{WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd oAnimationend",transition:"animationend"}:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd oTransitionend",transition:"transitionend"};for(var a in d){if(b.style[a]!==undefined){return d[a]}}},xTranS:function(a){return a>9999?(a/10000).toFixed(1)+"万":a},isLandscape:function(){var b=(typeof window.orientation==="number"&&typeof window.onorientationchange==="object");if(b&&!GlobalFun.android){var a=window.orientation;switch(a){case 90:case -90:a="landscape";break;default:a="portrait";break}}else{a=(window.innerWidth>window.innerHeight)?"landscape":"portrait"}return a=="landscape"?true:false},toShort:function(a){if(a>10000){a=Math.floor(a/10000)+Math.ceil((a%10000/1000))/10+"万"}return a},setStyle:function(b,a){for(i in a){b.style[i]=a[i]}},removeObjByClass:function(b){if(b.length!=undefined){for(i in b){document.getElementsByClassName(b[i])[0].parentNode.removeChild(document.getElementsByClassName(b[i])[0])}}else{document.getElementsByClassName(b)[0].parentNode.removeChild(document.getElementsByClassName(b)[0])}}}})();(function(){window.Video=function(){this._video=null;this.options={poster:v.poster,textTrackDisplay:false,loadingSpinner:true,bigPlayButton:false,controls:true,errorDisplay:true,textTrackSettings:false,preload:"metadata",controlBar:v.status==1?false:true}};Video.prototype={init:function(){this._video=document.createElement("video");this._video.id="video";this._video.setAttribute("webkit-playsinline",true);this._video.setAttribute("playsinline",true);this._video.setAttribute("x-webkit-airplay",true);if(GlobalFun.android&&isQQBrowser){this._video.setAttribute("x5-video-player-type","h5");this._video.setAttribute("x5-video-player-fullscreen",true);this._video.setAttribute("x5-video-orientation","landscape|portrait");this._video.setAttribute("x5-video-ignore-metadata",true)}var a=document.createElement("source");a.src=v.playUrl;if(v.playUrl.indexOf("m3u8")>0){a.setAttribute("type","application/x-mpegURL")}else{a.setAttribute("type","video/mp4")}this._video.appendChild(a);document.getElementsByClassName("d-video")[0].appendChild(this._video);this.buildPlayer()},buildPlayer:function(){var b=this;myPlayer=videojs(b._video,b.options,function a(){if(v.status==1){}listenX5Video();subTitle=document.createElement("div");subTitle.className="vjs-title";subTitle.innerHTML=v.title;document.getElementById("video").appendChild(subTitle);if(v.source==1){var d=document.createElement("a");d.className="downloadBtn";subTitle.appendChild(d);d.onclick=function(){_czc.push(["_trackEvent","斗地主","下载跳转量","播放页下载按钮",0,"downloadBtn"]);APPCommon.openApp()}}dmContainer=document.createElement("div");dmContainer.className="vjs-container-danmu";document.getElementById("video").appendChild(dmContainer);myDanmu=new Danmu(dmContainer);if(v.status==0){GlobalFun.removeObjByClass(["vjs-fullscreen-control","vjs-audio-button","vjs-captions-button","vjs-subtitles-button","vjs-descriptions-button","vjs-chapters-button","vjs-playback-rate","vjs-volume-menu-button"])}else{var g=document.createElement("div");g.className="vjs-control-danmu";document.getElementById("video").appendChild(g);playBtn=document.createElement("a");playBtn.className="vjs-control-playbtn";g.appendChild(playBtn);playBtn.onclick=function(){if(GlobalFun.hasClass(this,"paused")){myPlayer.play();this.classList.remove("paused")}else{myPlayer.pause();this.classList.add("paused")}};if(v.source==1){zanContainer=document.createElement("div");zanContainer.className="vjs-container-zan";document.getElementById("video").appendChild(zanContainer);myZan=new Zan(zanContainer);dmBtn=document.createElement("a");dmBtn.className="vjs-control-dmbtn";dmInput=document.createElement("div");dmInput.setAttribute("title","发表评论");dmInput.className="vjs-control-dminput";g.appendChild(dmInput);var f=document.createElement("input");f.setAttribute("placeholder","发表评论");f.id="send_msg_text";dmInput.appendChild(f);var c=document.createElement("a");c.innerHTML="发送";c.className="vjs-control-dmSend";dmInput.appendChild(c);f.onkeypress=function(h){if(h.keyCode==13){sendComment()}};f.onclick=function(){};c.onclick=function(){sendComment()};giftContainer=document.createElement("div");giftContainer.className="vjs-container-gift";document.getElementById("video").appendChild(giftContainer);var e=document.createElement("div");e.className="vjs-container-gift-center";giftContainer.appendChild(e);giftContainerBody=document.createElement("div");giftContainerBody.id="gift";e.appendChild(giftContainerBody);myGift=new Gift("#gift");pgc=document.createElement("div");pgc.className="vjs-container-pgc";document.getElementById("video").appendChild(pgc);dmBtn.onclick=function(){if(GlobalFun.hasClass(this,"close")){this.classList.remove("close");dmContainer.classList.remove("hide")}else{this.classList.add("close");dmContainer.classList.add("hide")}};document.getElementsByClassName("closeMask")[0].onclick=function(){document.getElementsByClassName("mask")[0].classList.remove("m-1")};getScript("//cdn.ronghub.com/RongIMLib-2.2.4.min.js",function(){getScript("./js/im_live.js",function(){console.log("IM消息加载完毕")})})}setInterval(function(){if(GlobalFun.android&&isQQBrowser&&_x5enter){if(GlobalFun.hasClass(document.getElementById("video"),"vjs-user-inactive")){document.getElementsByTagName("aside")[0].classList.add("hide")}else{document.getElementsByTagName("aside")[0].classList.remove("hide")}}else{document.getElementsByTagName("aside")[0].classList.remove("hide")}},33)}this.on("timeupdate",function(){if(v.status==0){}})})}}})();function getQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");var c=window.location.search.substr(1).match(b);if(c!=null){return unescape(decodeURI(c[2]))}return null}var has_un_token=0;if(localStorage.im_token!=undefined&&localStorage.im_token!="undefined"&&localStorage.im_token){has_un_token=1}$.ajax({url:mainUrl+"/ttdz/room",type:"GET",data:{chatroom_id:v.objectId,has_im_token:has_un_token},dataType:"json",success:function(a){console.log(a);var b=a.data;v.status=b.status;v.objectId=b.chatroom_id;v.title=b.title;v.playUrl=b.url;v.poster=b.cover;v.source=b.source!=undefined?b.source:1;if(localStorage.im_token!=undefined&&localStorage.im_token!="undefined"&&localStorage.im_token){v.im_token=localStorage.im_token}else{v.im_token=b.im_token;localStorage.im_token=b.im_token}document.getElementsByTagName("meta")[7].setAttribute("content",v.title);myVideo=new Video();myVideo.init()}});(function(){window.Danmu=function(b,a){this._element=b};Danmu.prototype={getPath:function(){var a=Math.floor(Math.random()*5)+1;var b="linear";switch(a){case 1:b="linear";break;case 2:b="ease";break;case 3:b="ease-in";break;case 4:b="ease-out";break;case 5:b="ease-in-out";break;default:b="linear";break}return b},getTop:function(){var a=document.getElementsByClassName("dd-item-1").length;var b=document.getElementsByClassName("dd-item-2").length;var c=document.getElementsByClassName("dd-item-3").length;if(a===0||a<=b&&a<=c){return 1}else{if(b===0||b<a&&b<=c){return 2}else{return 3}}},addDanmu:function(g,d){var e=this.getTop();var c=document.createElement("div");c.className="dd-item dd-item-"+e;GlobalFun.setStyle(c,{top:(e-1)*0.52+"rem",animationTimingFunction:this.getPath(),webkitAnimationTimingFunction:this.getPath()});var a=document.createElement("b");a.innerHTML=d;c.appendChild(a);var f=document.createElement("span");f.innerHTML=g;c.appendChild(f);this._element.appendChild(c);this.removeDanmu(c)},removeDanmu:function(c){var a=this;var b=GlobalFun.whichTransitionEvent("animation");if(b){c.addEventListener(b,function(){c.parentNode.removeChild(c)})}}}})();(function(){window.Zan=function(a){this.obj=a};Zan.prototype={getPath:function(){var a=Math.floor(Math.random()*5)+1;var b="linear";switch(a){case 1:b="linear";break;case 2:b="ease";break;case 3:b="ease-in";break;case 4:b="ease-out";break;case 5:b="ease-in-out";break}return b},getType:function(){return Math.floor(Math.random()*5)+1},getName:function(){return Math.floor(Math.random()*2)===1?"_moveX":"moveX"},creatZan:function(){var a=document.createElement("div");a.className="zan_item zan"+this.getType();a.style.webkitAnimationName=this.getName();a.style.animationName=this.getName();a.style.webkitAnimationTimingFunction=this.getPath();a.style.animationTimingFunction=this.getPath();a.style.opacity=(Math.floor(Math.random()*6)+5)/10;return a},removeObj:function(c){var a=GlobalFun.whichTransitionEvent("animation");var b=false;if(a){c.addEventListener(a,function(){if(b){return}c.parentNode.removeChild(c);b=true})}},init:function(){var a=this.creatZan();this.obj.appendChild(a);this.removeObj(a)}}})();(function(){window.Gift=function(a){this.$element=$(a);this.queueNum=0;this.nextQueue=[];this.leftGiftQueue=[];this.avatar="/Vss/images/share_1_4/header.jpg";this.name="大圣Live用户";this.giftName="";this.bundleNum=1;this.giftImage="";this.giftImageGifUrl="";this.type="type";this.uid=1};Gift.prototype={init:function(){this.popGift()},popGift:function(){var a=this;setInterval(function(){if(a.nextQueue.length===0){return}if(a.queueNum<2||a.checkSameUser(a.nextQueue[0].name,a.nextQueue[0].uid)!==null){avatar=a.nextQueue[0].avatar;name=a.nextQueue[0].name;giftName=a.nextQueue[0].giftName;giftImage=a.nextQueue[0].giftImage;giftId=a.nextQueue[0].uid;giftImageGifUrl=a.nextQueue[0].giftImageGifUrl;a.addGift(a.nextQueue[0]);a.nextQueue.splice(0,1)}},150)},checkSameUser:function(a){var b=null;this.$element.find(".gift").each(function(c,d){if($(d).attr("data-name")===a.name&&parseInt($(d).attr("data-uid"))===a.uid){b=$(d)}});return b},addGift:function(d){d.avatar=typeof d.avatar!=="undefined"?d.avatar:this.avatar;d.name=typeof d.name!=="undefined"?d.name:this.name;d.bundleNum=typeof d.bundleNum!=="undefined"?d.bundleNum:this.bundleNum;d.giftName=typeof d.giftName!=="undefined"?d.giftName:this.giftName;d.giftImage=typeof d.giftImage!=="undefined"?d.giftImage:this.giftImage;d.giftImageGifUrl=typeof d.giftImageGifUrl!=="undefined"?d.giftImageGifUrl:this.giftImageGifUrl;d.type=typeof d.type!=="undefined"?d.type:this.type;d.uid=typeof d.uid!=="undefined"?d.uid:this.uid;var e=this.checkSameUser(d);if(e!==null){this.$element.data("gift_"+d.uid+"_time",0);var a=e.find("b");var f=parseInt(a.text())+1;if(f>=100){a.parent().addClass("_100")}else{if(f>=50){a.parent().addClass("_50")}else{if(f>=20){a.parent().addClass("_20")}else{}}}a.html(f);a.addClass("numBounceIn");var c=GlobalFun.whichTransitionEvent("animation");if(c){a[0].addEventListener(c,function(){a.removeClass("numBounceIn")})}}else{if(this.queueNum<2){this.createGift(d)}else{this.nextQueue.push(d)}}},createGift:function(a){var g=document.createElement("div");g.className="gift";if(a.type=="fill"){g.classList.add("fill")}g.setAttribute("data-name",a.name);g.setAttribute("data-uid",a.uid);var n=document.createElement("table");g.appendChild(n);var k=document.createElement("tr");n.appendChild(k);var e=document.createElement("td");k.appendChild(e);var h=document.createElement("i");h.style.backgroundImage="url("+a.avatar+")";e.appendChild(h);var e=document.createElement("td");k.appendChild(e);var c=document.createElement("em");c.innerHTML=a.name;e.appendChild(c);var d=document.createElement("cite");d.innerHTML="送出 <span>"+a.bundleNum+"</span>个"+a.giftName;e.appendChild(d);var e=document.createElement("td");k.appendChild(e);var f=document.createElement("img");f.src=a.giftImage;e.appendChild(f);var e=document.createElement("td");k.appendChild(e);var m=document.createElement("strong");m.innerHTML="×";e.appendChild(m);var l=document.createElement("b");l.innerHTML="1";e.appendChild(l);var j=document.createElement("img");$(j).addClass("giftImageGif");$(j).attr("src",a.giftImageGifUrl);if(a.type=="fill"){$(j).css({display:"block","max-width":"80%","max-height":"80%",position:"fixed",left:"50%",top:"50%","-webkit-transform":"translate3d(-50%,-50%,0)",transform:"translate3d(-50%,-50%,0)","z-index":10001})}else{$(j).css({opacity:0,width:"2.4rem","margin-bottom":"-0.3rem","margin-left":"1rem",display:"none"})}this.sendGift(a,g,j)},sendGift:function(b,c,a){this.$element.prepend($(c));if(b.type=="fill"){$("body").prepend($(a))}else{this.$element.prepend($(a))}$(a).addClass("giftFadeIn");this.leftGiftQueue.push(a);if(this.queueNum>0){$(this.leftGiftQueue[0]).css({visibility:"hidden",display:"none"});this.leftGiftQueue.splice(0,1)}c.classList.add("giftIn");this.$element.data("gift_"+b.uid+"_time",0);this.queueNum+=1;this.countDown($(c),a,b)},countDown:function(d,a,c){var b=this;var e=setInterval(function(){var f="gift_"+c.uid+"_time";b.$element.data(f,parseInt(b.$element.data(f))+33);if(parseInt(b.$element.data(f))>=3000){d[0].classList.add("giftOut");a.classList.remove("giftFadeIn");b.giftEnd(d[0],a,c);clearInterval(e)}},33)},giftEnd:function(e,a,d){var c=this;var b=GlobalFun.whichTransitionEvent("animation");b&&e.addEventListener(b,function(){e.parentNode.removeChild(e);a?a.parentNode.removeChild(a):false;c.$element.data("gift_"+d.uid+"_time",0);for(var f=0;f<c.leftGiftQueue.length;f++){if(c.leftGiftQueue[f]==a){c.leftGiftQueue.splice(f,1);break}}c.queueNum-=1})}}})();(function(){window.TextData=function(){this.index=0;this.commentQueue=[];this.queue=-1};TextData.prototype={init:function(a){if(Math.floor(a/300)!=this.queue){this.queue=Math.floor(a/300);this.index=this.queue;this.getZip()}else{}},getZip:function(){var a=this;$.ajax({url:"//dasheng.test.appgame.com/share/getDanmuUrlByIndex",type:"POST",data:{videoId:v.objectId,index:a.index},dataType:"json",success:function(b){if(b.error===1){console.log(b.msg)}else{a.getData(b.data.url)}a.index+=1},error:function(b){console.log(b)}})},getData:function(a){var b=this;b.commentQueue.splice(0,b.commentQueue.length);$.ajax({url:"//dasheng.test.appgame.com/share/ajaxGetDanmu",type:"GET",data:{danmu_url:a,create_time:create_time},dataType:"json",timeout:3000,success:function(c){var f=c.data;for(var e=0;e<f.length;e++){if(f[e].content._lctype==21){}else{if(f[e].content._lctype==-1){var d={time:f[e].time,avatar:f[e].content._lcattrs.avatar,nickname:f[e].content._lcattrs.nickname,_lctext:f[e].content._lctext};b.commentQueue.push(d)}}}}})}}})();(function(){window.Vote=function(){this.voted=false;this.container=null;this.voteBtn=null;this.totalTime=0;this.voteId=0};Vote.prototype={create:function(c,b){var a=this;a.voteBtn=a.createButton(c);setTimeout(function(){a.voteBtn.parentNode.classList.add("stretch")},100);a.container=a.createContainer(c,b);a.createEvent();if(b.vote_type==1){a.countDown()}a.voted=true},init:function(c,b){var a=this;if(a.voted){a.update(b)}else{if(a.voteId!=0&&a.voteId!=b.vote_id){if(a.voteBtn!=null&&GlobalFun.hasClass(a.voteBtn.parentNode,"stretch")){a.voteBtn.parentNode.classList.remove("stretch")}if(a.container!=null&&GlobalFun.hasClass(a.container.voteBody,"stretch")){a.container.voteBody.classList.remove("stretch")}setTimeout(function(){if(a.voteBtn!=null){a.voteBtn.parentNode.parentNode.removeChild(a.voteBtn.parentNode)}if(a.container!=null){a.container.voteBody.parentNode.removeChild(a.container.voteBody)}a.create(c,b)},300)}else{a.create(c,b)}a.voted=true}},createEvent:function(d,a,b){var c=this;c.voteBtn.onclick=function(){c.voteBtn.parentNode.classList.remove("stretch");c.container.voteBody.classList.add("stretch")};c.container.voteBody.onclick=function(){document.getElementsByClassName("mask")[0].classList.add("m-1")};c.container.voteClose.onclick=function(f){f.stopPropagation();c.container.voteBody.classList.remove("stretch");if(GlobalFun.hasClass(c.container.voteBody,"end")){setTimeout(function(){c.container.voteBody.parentNode.removeChild(c.container.voteBody);c.voteBtn.parentNode.parentNode.removeChild(c.voteBtn.parentNode);c.voteBtn=null;c.container=null},300)}else{c.voteBtn.parentNode.classList.add("stretch")}}},createButton:function(c){var a=document.createElement("div");a.className="vjs-vote-button";c.appendChild(a);var b=document.createElement("a");a.appendChild(b);return b},createContainer:function(c,d){var b=document.createElement("div");b.className="vjs-container-vote";b.id="vote_"+d.vote_id;this.voteId=d.vote_id;b.classList.add("vjs-container-item-"+d.vote_option.length);c.appendChild(b);var q=document.createElement("a");q.className="vjs-vote-close";b.appendChild(q);var k=document.createElement("div");k.className="vjs-vote-subTitle";k.innerHTML="投票";b.appendChild(k);var s=document.createElement("div");s.className="vjs-vote-pubTitle";if(d.vote_type!=1){s.classList.add("pd29")}s.innerHTML=d.name;b.appendChild(s);if(d.vote_type==1){var m=document.createElement("div");m.className="vjs-vote-countTime";m.innerHTML=this.toTime(d.count_down);b.appendChild(m);this.totalTime=d.count_down}var l=document.createElement("ul");b.appendChild(l);var o=[],n=[],a=[];for(var g=0;g<d.vote_option.length;g++){o[g]=document.createElement("li");l.appendChild(o[g]);n[g]=document.createElement("p");n[g].innerHTML=d.vote_option[g].name;o[g].appendChild(n[g]);a[g]=document.createElement("i");a[g].innerHTML=d.vote_option[g].vote_count;o[g].appendChild(a[g])}var r=document.createElement("div");r.className="vjs-vote-rankTitle";r.innerHTML="贡献榜";b.appendChild(r);var j=document.createElement("dl");b.appendChild(j);var e=[],h=[],f=[];for(var g=0;g<d.top_user.length;g++){e[g]=document.createElement("dt");e[g].setAttribute("uid",d.top_user[g].uid);j.appendChild(e[g]);h[g]=document.createElement("i");h[g].style.backgroundImage="url("+d.top_user[g].avatar+")";e[g].appendChild(h[g]);f[g]=document.createElement("p");f[g].innerHTML=this.toCount(d.top_user[g].top_count);e[g].appendChild(f[g])}for(var g=d.top_user.length;g<3;g++){e[g]=document.createElement("dt");j.appendChild(e[g]);h[g]=document.createElement("i");h[g].style.backgroundImage="url(../src/images/vote/mask@2x.png)";e[g].appendChild(h[g]);f[g]=document.createElement("p");f[g].innerHTML="抢占";e[g].appendChild(f[g])}return{voteClose:q,voteBody:b,items:l,voteNum:a,topUser:{avatar:h,count:f},countTime:m,subTitle:k}},update:function(c){console.log("update"+new Date().getTime());var a=this.container.voteNum;var d=this.container.topUser;for(var b=0;b<c.vote_option.length;b++){a[b].innerHTML=c.vote_option[b].vote_count}for(var b=0;b<c.top_user.length;b++){d.avatar[b].style.backgroundImage="url("+c.top_user[b].avatar+")";d.count[b].innerHTML=this.toCount(c.top_user[b].top_count)}},end:function(c){var a=this;if(c.ans_option_id==0&&c.result[0]==0){return}if(!a.voted){a.init(c)}else{a.update(c)}a.voteBtn.parentNode.classList.add("end");a.container.voteBody.classList.add("end");if(c.ans_option_id==0){a.container.voteBody.classList.add("end-1");for(var b=0;b<c.result.length;b++){a.container.voteBody.classList.add("ans-"+c.result[b])}}else{a.container.voteBody.classList.add("end-2");a.container.voteBody.classList.add("ans-"+c.ans_option_id)}a.container.subTitle.innerHTML="结果";a.voted=false},toTime:function(b){var b=parseInt(b),d=0,a=0,c=0;d=Math.floor(b/60/60);a=Math.floor(b/60)%60;c=b%60;d=d>0?(d>9?d:"0"+d):0;a=a>0?(a>9?a:"0"+a):"00";c=c>0?(c>9?c:"0"+c):"00";if(d!=0){return d+":"+a+":"+c}else{return a+":"+c}},toCount:function(a){var a=parseInt(a);if(a>10000){a=(a/10000).toFixed(1)+"W"}else{if(a>1000){a=(a/1000).toFixed(1)+"K"}}return a},countDown:function(){var a=this;setInterval(function(){if(a.totalTime==0){return}a.totalTime--;a.container.countTime.innerHTML=a.toTime(a.totalTime)},1000)}}})();var myVote=new Vote();(function(){window.Lottery=function(){this.lotteryStatus=[0,0,0];this.container=null;this.lotteryBtn=null;this.lotteryId=0};Lottery.prototype={create:function(c,b){var a=this;a.createButton(c,b);setTimeout(function(){a.lotteryBtn.classList.add("stretch")},100);a.container=a.createContainer(c,b);a.createEvent()},init:function(c,b){var a=this;if(!a.lotteryStatus[0]){a.create(c,b)}else{if(b.result_data){if(!a.lotteryStatus[2]){a.end(b.result_data)}else{console.log("已出结果")}}else{if(b.stages==3){if(!a.lotteryStatus[1]){a.lottery(a.container.label,a.container.lotteryBody,a.container.join)}else{console.log("正在抽奖")}}else{console.log("正在报名")}}}},createEvent:function(){var a=this;a.lotteryBtn.onclick=function(){a.lotteryBtn.classList.remove("stretch");a.container.lotteryBody.classList.add("stretch")};a.container.lotteryBody.onclick=function(){document.getElementsByClassName("mask")[0].classList.add("m-1")};a.container.lotteryClose.onclick=function(b){b.stopPropagation();a.container.lotteryBody.classList.remove("stretch");if(GlobalFun.hasClass(a.container.lotteryBody,"end")){setTimeout(function(){a.container.lotteryBody.parentNode.removeChild(a.container.lotteryBody);a.lotteryBtn.parentNode.removeChild(a.lotteryBtn);a.lotteryBtn=null;a.container=null},300)}else{a.lotteryBtn.classList.add("stretch")}}},createButton:function(c,b){var a=document.createElement("div");a.className="vjs-lottery-button";if(b.result_data){a.innerHTML="中奖结果"}else{if(b.stages==3){a.innerHTML="正在抽奖"}else{a.innerHTML="点击参加"}}c.appendChild(a);this.lotteryBtn=a;return a},createContainer:function(c,d){this.lotteryStatus[0]=1;var j=["gold","diamond","total"];var b=document.createElement("div");b.className="vjs-container-lottery";b.id="lottery_"+d.lottery_id;this.lotteryId=d.lottery_id;b.classList.add("vjs-container-lottery-"+j[d.type-1]);c.appendChild(b);var f=document.createElement("div");f.className="vjs-lottery-body";b.appendChild(f);var a=document.createElement("a");a.className="vjs-lottery-close";a.innerHTML="收起";f.appendChild(a);var g=document.createElement("h3");g.innerHTML=d.title;f.appendChild(g);var h=document.createElement("label");f.appendChild(h);var e=null;if(d.stages!=3){e=document.createElement("a");e.className="vjs-lottery-join";e.innerHTML="点击参与";f.appendChild(e)}var k=null;if(d.stages==3){b.classList.add("lottery-status-lotterying");if(d.result_data){h.innerHTML="<span>中奖结果</span>";k=this.createOwner(b,d.result_data)}else{this.lottery(h,lotteryBody,e)}}else{if(d.type==1||d.type==2){h.innerHTML="<span>消化"+d.price+"</span><span>"+(d.type==1?"大圣币":"钻石")+"</span>"}else{h.innerHTML="<span>0消耗</span><span>参与</span>"}}return{lotteryBody:b,lotteryClose:a,label:h,join:e,pull:k}},createOwner:function(h,e){var a=document.createElement("div");a.className="vjs-lottery-owner";h.appendChild(a);var g=document.createElement("a");g.className="pull";a.appendChild(g);var c=document.createElement("div");c.className="avatar";a.appendChild(c);var d=document.createElement("i");d.style.backgroundImage="url("+e.avatar+")";c.appendChild(d);var b=document.createElement("img");b.src="../src/images/lottery/ticket@2x.png";c.appendChild(b);var h=document.createElement("p");h.innerHTML=e.nickname+"<br>@"+e.uid;a.appendChild(h);var f=document.createElement("span");f.innerHTML=e.win_content;a.appendChild(f);this.lotteryStatus[2]=1;return g},lottery:function(b,a,c){this.lotteryBtn.innerHTML="开始抽奖";b.innerHTML="<span>抽奖中...</span>";a.classList.add("lottery-status-lotterying");if(c!=null){c.parentNode.removeChild(this.container.join)}this.lotteryStatus[1]=1},end:function(a){this.lotteryBtn.innerHTML="中奖结果";this.container.lotteryBody.classList.add("lottery-status-lotterying");this.container.label.innerHTML="中奖结果";if(this.container.join){this.container.join.parentNode.removeChild(this.container.join)}this.createOwner(this.container.lotteryBody,a)},close:function(){var a=this;if(a.lotteryBtn){if(GlobalFun.hasClass(a.lotteryBtn,"stretch")){a.lotteryBtn.classList.remove("stretch")}setTimeout(function(){a.lotteryBtn.parentNode.removeChild(a.lotteryBtn);a.lotteryBtn=null},300)}if(a.container.lotteryBody){if(GlobalFun.hasClass(a.container.lotteryBody,"stretch")){a.container.lotteryBody.classList.remove("stretch")}setTimeout(function(){a.container.lotteryBody.parentNode.removeChild(a.container.lotteryBody);a.container=null},300)}a.lotteryStatus=[0,0,0];a.lotteryId=0}}})();var myLottery=new Lottery();var listenX5Video=function(){_x5enter=false;myVideo._video.addEventListener("x5videoenterfullscreen",function(){_x5enter=true;$("#video").addClass("vjs-x5");$(".main").addClass("x5");myVideo._video.style.width=GlobalFun.screenWidth()+"px";myVideo._video.style.height=GlobalFun.screenHeight()+"px"});myVideo._video.addEventListener("x5videoexitfullscreen",function(){_x5enter=false;$("#video").removeClass("vjs-x5");$(".main").removeClass("x5");playBtn.classList.add("paused");myVideo._video.style.width="100%";myVideo._video.style.height="100%"});window.addEventListener("resize",function(){if(_x5enter){myVideo._video.style.width=GlobalFun.screenWidth()+"px";myVideo._video.style.height=GlobalFun.screenHeight()+"px"}},false)};window.addEventListener("resize",function(){myVideo._video.style["object-position"]="50% 50%"},false);$(".d1 .button").on("click",function(){_czc.push(["_trackEvent","斗地主","下载跳转量","弹幕评论",0,"dmcomment"]);APPCommon.openApp()});