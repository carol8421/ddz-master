RongIMClient.init(appKey);var token=v.im_token;var conversationtype=RongIMLib.ConversationType.CHATROOM;var chatroomId=v.objectId;var random=Math.floor(Math.random()*900000+100000);var sendTimes=0;var cookie_nickname=sessionStorage.getItem("Nick")!=null&&sessionStorage.getItem("Nick")!=""?sessionStorage.getItem("Nick"):false;var cookie_avatar=sessionStorage.getItem("HeadURL")!=null?sessionStorage.getItem("HeadURL"):false;var times=0;var localUid=null;var merit=function(a,b){return a!="undefined"&&a!=null&&a!=""?a:b};var connectError=function(a){CommonJS.Toast(a)};var AbnormalMode=function(){pgc.parentNode.removeChild(pgc);giftContainer.parentNode.removeChild(giftContainer);zanContainer.parentNode.removeChild(zanContainer);dmContainer.parentNode.removeChild(dmContainer)};RongIMClient.connect(token,{onSuccess:function(a){localUid=a;console.log("Login successfully."+a);RongIMClient.getInstance().joinChatRoom(chatroomId,0,{onSuccess:function(){},onError:function(b){console.log(b)}})},onTokenIncorrect:function(){console.log("token无效");debugMsg="token无效";AbnormalMode()},onError:function(b){var a="";switch(b){case RongIMLib.ErrorCode.TIMEOUT:a="超时";break;case RongIMLib.ErrorCode.UNKNOWN_ERROR:a="未知错误";break;case RongIMLib.ErrorCode.UNACCEPTABLE_PaROTOCOL_VERSION:a="不可接受的协议版本";break;case RongIMLib.ErrorCode.IDENTIFIER_REJECTED:a="appkey不正确";break;case RongIMLib.ErrorCode.SERVER_UNAVAILABLE:a="服务器不可用";break}console.log(b);debugMsg=a}});RongIMClient.setConnectionStatusListener({onChanged:function(a){switch(a){case RongIMLib.ConnectionStatus.CONNECTED:console.log("链接成功");break;case RongIMLib.ConnectionStatus.CONNECTING:console.log("正在链接");break;case RongIMLib.ConnectionStatus.DISCONNECTED:console.log("断开连接");connectError("IM已断开连接");AbnormalMode();break;case RongIMLib.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:console.log("其他设备登录");connectError("其他设备登录");AbnormalMode();break;case RongIMLib.ConnectionStatus.NETWORK_UNAVAILABLE:console.log("网络不可用");connectError("网络不可用");AbnormalMode();break}}});RongIMClient.setOnReceiveMessageListener({onReceived:function(a){switch(a.messageType){case RongIMClient.MessageType.TextMessage:addMsg(a);break;default:}}});var isset=function(a){if(typeof(a)!=undefined&&a!=undefined&&a!="undefined"&&a!=""&&a!=null){return true}return false};var compontentData={vote:function(b){var a={vote_option:isset(b.vote_data.vote_option)?b.vote_data.vote_option:0,name:isset(b.vote_data.name)?b.vote_data.name:0,top_user:isset(b.top_user)?b.top_user:[],count_down:isset(b.vote_data.count_down)?b.vote_data.count_down:0,vote_id:isset(b.vote_data.vote_id)?parseInt(b.vote_data.vote_id):0,vote_type:isset(b.vote_data.vote_type)?parseInt(b.vote_data.vote_type):0,ans_option_id:isset(b.vote_data.ans_option_id)?b.vote_data.ans_option_id:0,result:isset(b.result_data.result)?b.result_data.result:0,status:isset(b.result_data.status)?b.result_data.status:0};myVote.init(pgc,a)},punishment:function(b){console.log(b);var a={status:b.status,punishment_id:parseInt(b.punish_id),title:b.title,user:{u1:{nick:b.extra_data.result_data[0].nickname,total:b.extra_data.result_data[0].top_count},u2:{nick:b.extra_data.result_data[1].nickname,total:b.extra_data.result_data[1].top_count}},count_down:b.extra_data.count_down,score:isset(b.score)?b.score:[0,0]};console.log(a);myPunishment.init(pgc,a)},lottery:function(b){var a={type:isset(b.lottery_data.type)?b.lottery_data.type:0,lottery_id:isset(b.lottery_data.lottery_id)?parseInt(b.lottery_data.lottery_id):0,title:isset(b.lottery_data.title)?b.lottery_data.title:0,stages:isset(b.lottery_data.stages)?parseInt(b.lottery_data.stages):0,price:isset(b.lottery_data.price)?b.lottery_data.price:0,result_data:!$.isEmptyObject(b.result_data)?b.result_data:false};myLottery.init(pgc,a)}};function addMsg(f){var e=typeof(f.content.content)=="string"?JSON.parse(f.content.content):f.content.content;switch(e.type){case 1:var a=merit(e.data.nick,"游客"+random);var b=merit(e.data.text,"支持一下~");b=b.replace(/[<>&"]/g,function(g){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[g]});var c=/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g;var d=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&:/~\+#]*[\w\-\@?^=%&/~\+#])?/;if(c.test(b)||d.test(b)){b="支持一下~"}else{b=b.replace(/共产党/g,function(j){var g="";for(var h=0;h<j.length;h++){g+="*"}return g})}myDanmu.addDanmu(b,a);break;case 2:break;case 3:break;case 4:myZan.init();break;case 101:myPlayer.pause();break;case 52:break;case 200:case 201:case 209:compontentData.vote(e.data);break;case 231:case 232:case 234:compontentData.punishment(e.data);break;case 226:case 221:case 222:case 227:compontentData.lottery(e.data);break;case 1010:break;default:break}}function onSendMsg(a){RongIMClient.getInstance().sendMessage(conversationtype,chatroomId,a,{onSuccess:function(b){addMsg(b);$("#send_msg_text").val("")},onError:function(d,b){var c="";switch(d){case RongIMLib.ErrorCode.TIMEOUT:c="超时";break;case RongIMLib.ErrorCode.UNKNOWN_ERROR:c="未知错误";break;case RongIMLib.ErrorCode.REJECTED_BY_BLACKLIST:c="在黑名单中，无法向对方发送消息";break;case RongIMLib.ErrorCode.NOT_IN_DISCUSSION:c="不在讨论组中";break;case RongIMLib.ErrorCode.NOT_IN_GROUP:c="不在群组中";break;case RongIMLib.ErrorCode.NOT_IN_CHATROOM:c="不在聊天室中";break;default:c=d;break}console.log("发送失败:"+c)}})}function sendMsg(g){var f=g;var d=f.replace(/[<>&"]/g,function(h){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[h]});if(d.length<1){return}var a=merit(cookie_nickname,"斗地主用户"+random);a=a.replace(/[<>&"]/g,function(h){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[h]});var c=merit(cookie_avatar,"https://web.ddz.dasheng.tv/images/hall/share.png");var b={type:1,data:{uid:1,nick:a,photo_url:c,text:d}};d=JSON.stringify(b);var e=new RongIMLib.TextMessage({content:d});onSendMsg(e)}var forbidStart=false;function sendComment(a){if(a==null||a==""){return false}if(sendTimes==0){timing=true}if(sendTimes>=3&&times<=10000){if(!forbidStart){times=0;forbidStart=true}$(commentList).removeClass("show");CommonJS.Toast("刷屏的不是乖宝宝，歇 "+Math.ceil((10000-times)/1000)+" 秒吧~")}else{sendTimes++;sendMsg(a)}}var timing=false;setInterval(function(){if(!timing){return}times+=33;if(times>=10000){sendTimes=times=0;timing=forbidStart=false}tipsed=false},33);var tomatoForbidStart=false;function sendTomato(b){if(b==null||b==""){return false}if(tomatoSendTimes==0){tomatoTiming=true}if(tomatoSendTimes>=3&&tomatoTimes<=15000){if(!tomatoForbidStart){tomatoForbidStart=true;tomatoTimes=0}CommonJS.Toast("是有多大的仇，歇 "+Math.ceil((15000-tomatoTimes)/1000)+" 秒吧~")}else{tomatoSendTimes++;tomato.classList.add("show");tomatoFinish=false;var a=CommonJS.WhichTransitionEvent("animation");if(a){tomato.addEventListener(a,function(){tomato.classList.remove("show");tomatoFinish=true})}}}var tomatoTiming=false;var tomatoTimes=0;var tomatoSendTimes=0;setInterval(function(){if(!tomatoTiming){return}tomatoTimes+=33;if(tomatoTimes>=15000){tomatoSendTimes=tomatoTimes=0;tomatoTiming=tomatoForbidStart=false}},33);function zan(){var a={type:4,data:{color_index:Math.floor(Math.random()*7)+1}};var b=JSON.stringify(a);var c=new RongIMLib.TextMessage({content:b});onSendMsg(c)};