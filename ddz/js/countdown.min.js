var uin=CommonJS.GetQueryString("uin")?CommonJS.GetQueryString("uin"):sessionStorage.getItem("ddz_uin");uin=uin?uin.replace("o",""):false;var prizeList=[1,2,3,4];var countTime=60;var waitTimes=60;var hostUrl=window.location.href.match(/web.ddz.dasheng.tv/)?"https://api.dasheng.tv:4431":"https://api.ttt.dasheng.tv:4433";var prizeListUrl="/v1/activity/ddz-angel-prize/get-prize-list";var reportUrl="/v1/activity/ddz-angel-prize/count-down";var getPrizeUrl="/v1/activity/ddz-angel-prize/prize";var getCaptcha="/v1/user/auth/captcha";var login="/v1/activity/auth/login";var prize_id=0;var isGet=false;var getPrizeList=function(){$.ajax({url:hostUrl+prizeListUrl,type:"GET",headers:{token:localStorage.tsawz_token},dataType:"json",success:function(a){if(a.code==0){if(a.data["switch"]==1){prizeList=a.data.list?a.data.list:prizeList;prizeQueue=prizeList.slice();document.getElementById("video").appendChild(countDown);showPrizeList(countDown)}else{if(!v._29s){subTitle.appendChild(liveDownloadBtn)}}}else{CommonJS.Toast(a.msg)}},error:function(a){CommonJS.Toast(a)}})};var countDownGift=null,countDownTime=null;var showPrizeList=function(c){isGet=false;jumpWait=false;if(prizeQueue.length==0){prizeQueue=prizeList.slice()}prize_id=prizeQueue.shift();if(!countDownGift){countDownGift=document.createElement("div");c.appendChild(countDownGift)}countDown.classList.add("disable");countDownGift.className="countDownGift g_"+prize_id;if(!countDownTime){countDownTime=document.createElement("time");c.appendChild(countDownTime)}report(prize_id);var b=countTime;countDownTime.innerHTML="<strong>"+b+"</strong>秒可领取";var a=setInterval(function(){if(b>0){b--;countDownTime.innerHTML="<strong>"+b+"</strong>秒后领取"}else{countDown.classList.remove("disable");countDownTime.innerHTML="<strong>可领取</strong>";isGet=true;wait();clearInterval(a)}},1000)};var jumpWait=false;var wait=function(){var b=waitTimes;var a=setInterval(function(){b--;if(b<=0||jumpWait){if(prizeList.length!=0){showPrizeList(countDown)}else{countDown.parentNode.removeChild(countDown)}clearInterval(a)}},1000)};var report=function(a){$.ajax({url:hostUrl+reportUrl,type:"GET",data:{uin:uin,prize_id:a},dataType:"json",success:function(b){if(b.code!=0){CommonJS.Toast(b.msg)}},error:function(b){CommonJS.Toast(b)}})};countDown.onclick=function(){if(!isGet){return}getPrize()};var getPrize=function(){if(localStorage.tsawz_phone!=undefined&&localStorage.tsawz_phone!="undefined"&&localStorage.tsawz_phone){$.ajax({url:hostUrl+getPrizeUrl,type:"GET",data:{prize_type:prize_id,uin:uin},headers:{token:localStorage.tsawz_TOKEN},dataType:"json",success:function(a){if(a.code==0){for(var b=0;b<prizeList.length;b++){if(prizeList[b]==prize_id){prizeList.splice(b,1)}}jumpWait=true;$(".box code").html(localStorage.tsawz_phone);$(".box").addClass("show")}else{if(a.code==20003||a.code==20006||a.code==20000){$(".login").addClass("show")}else{CommonJS.Toast(a.msg)}}},error:function(a){CommonJS.Toast(a)}})}else{$(".login").addClass("show")}};var sendedMsg=false;$(".getCode").on("click",function(){if(sendedMsg){return}var a=document.getElementById("phone").value;$.ajax({url:hostUrl+getCaptcha,type:"GET",data:{phonenum:a},dataType:"json",beforeSend:function(){sendedMsg=true},success:function(b){if(b.code==0){CommonJS.Toast("请注意查收短信");var d=60;var c=setInterval(function(){if(d<=0){sendedMsg=false;$(".getCode").html("重新发送");clearInterval(c)}else{d-=1;$(".getCode").html("重新发送("+d+")")}},1000)}else{sendedMsg=false;CommonJS.Toast(b.msg)}},error:function(b){sendedMsg=false;CommonJS.Toast(b)}})});var loginClick=false;$(".loginBtn").on("click",function(){if(loginClick){return}var a=document.getElementById("phone").value;var b=document.getElementById("code").value;$.ajax({url:hostUrl+login,type:"POST",data:{phonenum:a,phone_captcha:b},dataType:"json",beforeSend:function(){loginClick=true},success:function(c){if(c.code==0){localStorage.tsawz_TOKEN=c.data.token;localStorage.tsawz_phone=a;$(".login").hide();CommonJS.Toast("登录成功！",2000)}if(c.code==20006){loginClick=false;CommonJS.Toast("亲，你还没有注册哦，请点击 ↓",3000)}else{loginClick=false;CommonJS.Toast(c.msg)}},error:function(c){loginClick=false;CommonJS.Toast(c)}})});$(".registerBtn, .download").on("click",function(){CommonAPP.openApp()});$(".login .close").on("click",function(){$(".login").removeClass("show")});$(".box .close").on("click",function(){$(".box").removeClass("show")});if(uin){getPrizeList()};