var v={objectId:CommonJS.GetQueryString("videoId"),status:CommonJS.GetQueryString("status"),gifts_list:{}};var resizeEvt="orientationchange" in window?"orientationchange":"resize";var clickEvt=("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch?"touchend":"click";var tomatoFinish=false;var manifest=[];for(var i=1;i<=41;i++){manifest.push({src:"./images/tomato/"+i+".png",id:"image"})}var myPreload=new createjs.LoadQueue(true);myPreload.installPlugin(createjs.Sound);myPreload.on("fileload",handleFileLoad);myPreload.on("progress",handleFileProgress);myPreload.on("complete",loadComplete);myPreload.on("error",loadError);function handleFileLoad(a){console.log("文件类型: "+a.item.id+" 加载成功")}function loadError(a){console.log("加载出错！",a.text)}function handleFileProgress(a){}function loadComplete(a){console.log("已加载完毕全部资源");tomatoFinish=true}(function(){window.Video=function(){this._video=null;this.options={poster:v._29s?false:v.poster,textTrackDisplay:false,loadingSpinner:true,bigPlayButton:false,controls:v._29s?false:true,errorDisplay:true,textTrackSettings:false,preload:"metadata",inactivityTimeout:v._29s?2000:5000,controlBar:v._29s||v.status==1?false:true}};Video.prototype={init:function(){this._video=document.createElement("video");this._video.id="video";this._video.setAttribute("webkit-playsinline",true);this._video.setAttribute("playsinline",true);this._video.setAttribute("x-webkit-airplay",true);if(CommonAPP.android&&CommonAPP.MQQBrowser()){this._video.setAttribute("x5-video-player-type","h5");this._video.setAttribute("x5-video-player-fullscreen",true);this._video.setAttribute("x5-video-orientation","landscape");this._video.setAttribute("x5-video-ignore-metadata",true)}var a=document.createElement("source");a.src=v.playUrl;if(v.playUrl.indexOf("m3u8")>0){a.setAttribute("type","application/x-mpegURL")}else{a.setAttribute("type","video/mp4")}this._video.appendChild(a);document.getElementsByClassName("d-video")[0].appendChild(this._video);this.buildPlayer()},buildPlayer:function(){var b=this;myPlayer=videojs(b._video,b.options,function a(){listenX5Video();subTitle=document.createElement("div");subTitle.className="vjs-title";subTitle.innerHTML=v._29s?v._29s.topic:v.title;document.getElementById("video").appendChild(subTitle);if(!CommonAPP.android&&CommonJS.GetQueryString("compatibleVersion")==1||!CommonAPP.android&&sessionStorage.getItem("compatibleVersion")==1||v._29s){}else{liveDownloadBtn=document.createElement("a");liveDownloadBtn.className="downloadBtn"}countDown=document.createElement("div");countDown.className="countDown";if(uin){CommonJS.CreateScript("./js/countdown.js",function(){})}else{if(!v._29s){subTitle.appendChild(liveDownloadBtn)}}dmContainer=document.createElement("div");dmContainer.className="vjs-container-danmu";document.getElementById("video").appendChild(dmContainer);myDanmu=new Danmu(dmContainer);if(v.status==0){CommonJS.RemoveObjByClass(["vjs-audio-button","vjs-captions-button","vjs-subtitles-button","vjs-descriptions-button","vjs-chapters-button","vjs-playback-rate","vjs-volume-menu-button"])}else{zanContainer=document.createElement("div");zanContainer.className="vjs-container-zan";document.getElementById("video").appendChild(zanContainer);myZan=new Zan(zanContainer);var h=document.createElement("div");h.className="vjs-control-danmu";document.getElementById("video").appendChild(h);playBtn=document.createElement("a");playBtn.className="vjs-control-playbtn";h.appendChild(playBtn);dmBtn=document.createElement("a");dmBtn.className="vjs-control-dmbtn";dmInput=document.createElement("div");dmInput.setAttribute("title","发表评论");dmInput.className="vjs-control-dminput";h.appendChild(dmInput);var d=document.createElement("input");d.setAttribute("placeholder","吐个槽呗~");d.id="send_msg_text";dmInput.appendChild(d);var e=document.createElement("a");e.innerHTML="发送";e.className="vjs-control-dmSend";dmInput.appendChild(e);d.onkeypress=function(B){if(B.keyCode==13){sendComment(d.value)}};d.onclick=function(){};e.onclick=function(){sendComment(d.value)};var f=document.createElement("div");f.className="vjs-control-gift";f.onclick=function(){document.getElementsByClassName("mask")[0].classList.add("m-1")};commentList=document.createElement("div");commentList.className="vjs-control-commentList";commentList.innerHTML="<a>666</a><a>2333</a><a>厉害了主播</a><a>你的牌打得也太好了</a><a>快点啊，等到花儿都谢了</a><a>搞事情</a><a>扎心了</a>";h.appendChild(commentList);var o=document.createElement("div");o.className="vjs-control-comment";h.appendChild(o);o.onclick=function(){$(commentList).toggleClass("show")};setInterval(function(){if($(commentList).hasClass("show")){myPlayer.userActivity_=true}},4000);var u=document.createElement("div");u.className="vjs-control-cai";h.appendChild(u);var y=document.getElementById("tomato");u.onclick=function(){if(!tomatoFinish||y.className.match(new RegExp("(\\s|^)show(\\s|$)"))){return}sendTomato("向主播扔了一个番茄")};var n=document.createElement("div");n.className="vjs-control-zan";h.appendChild(n);$(document).delegate(".vjs-control-zan",clickEvt,function(){zan();$(commentList).removeClass("show")});giftContainer=document.createElement("div");giftContainer.className="vjs-container-gift";document.getElementById("video").appendChild(giftContainer);var q=document.createElement("div");q.className="vjs-container-gift-center";giftContainer.appendChild(q);giftContainerBody=document.createElement("div");giftContainerBody.id="gift";q.appendChild(giftContainerBody);myGift=new Gift("#gift");pgc=document.createElement("div");pgc.className="vjs-container-pgc";document.getElementById("video").appendChild(pgc);playBtn.onclick=function(){if(this.className.match(new RegExp("(\\s|^)paused(\\s|$)"))){myPlayer.play();this.classList.remove("paused")}else{myPlayer.pause();this.classList.add("paused")}};dmBtn.onclick=function(){if(this.className.match(new RegExp("(\\s|^)close(\\s|$)"))){this.classList.remove("close");dmContainer.classList.remove("hide")}else{this.classList.add("close");dmContainer.classList.add("hide")}};document.getElementsByClassName("closeMask")[0].onclick=function(){document.getElementsByClassName("mask")[0].classList.remove("m-1")};CommonJS.CreateScript("//cdn.ronghub.com/RongIMLib-2.2.4.min.js",function(){CommonJS.CreateScript("./js/im_live.js",function(){console.log("IM消息加载完毕")})})}setInterval(function(){var C=document.getElementsByTagName("aside")[0];if(CommonAPP.android&&CommonAPP.MQQBrowser()&&_x5enter){var B=document.getElementById("video");if(B.className.match(new RegExp("(\\s|^)vjs-user-inactive(\\s|$)"))||B.className.match(new RegExp("(\\s|^)vjs-paused(\\s|$)"))){C.classList.add("hide")}else{C.classList.remove("hide")}}else{C.classList.remove("hide")}},33);var t=null;var z=v._29s?true:false;if(z&&!t){t=document.createElement("div");t.className="vjs-29sBody";document.getElementById("video").appendChild(t);var p=document.createElement("div");p.className="vjs-29sLeftSide shadow";t.appendChild(p);_29sAbout(p,v._29s.recommend_list);var g=544/960*document.documentElement.clientHeight;_29sContent=document.createElement("div");_29sContent.className="vjs-29sContent";if(g>0){_29sContent.style.width=g+"px"}t.appendChild(_29sContent);_29sTime=document.createElement("div");_29sTime.className="vjs-29sContent-time";_29sContent.appendChild(_29sTime);_29sTotalTime=Math.floor(this.duration())||29;_29sTime.innerHTML='<img src="./images/number/2.png" alt=""><img src="./images/number/9.png" alt="">';var w=document.createElement("div");w.className="vjs-29sContent-text";_29sContent.appendChild(w);var A=document.createElement("div");A.className="vjs-29sContent-poster";_29sContent.appendChild(A);var m=document.createElement("i");m.style.backgroundImage="url("+v.poster+")";A.appendChild(m);A.onclick=function(){if(myPlayer.paused()){myPlayer.play()}else{myPlayer.pause()}};var r=document.createElement("div");r.className="vjs-29sContent-topic";r.innerHTML="<b>#</b> "+v._29s.topic+" <b>#</b>";w.appendChild(r);var k=document.createElement("div");k.className="vjs-29sContent-drama";k.innerHTML=v._29s.drama;if(v._29s.drama!==""){w.appendChild(k)}var c=document.createElement("div");c.className="vjs-29sRightSide shadow";t.appendChild(c);var s=document.createElement("a");s.className="vjs-29sRightSide-avator";s.style.backgroundImage="url("+v._29s.avator+")";c.appendChild(s);var x=document.createElement("span");x.className="vjs-29sRightSide-nick";x.innerHTML=v._29s.nick;s.appendChild(x);var j=document.createElement("span");j.className="vjs-29sRightSide-uid";j.innerHTML="大圣ID："+v._29s.uid;s.appendChild(j);s.onclick=function(){_hmt.push(["_trackEvent","斗地主直播间","点击","主播头像",1]);_czc.push(["_trackEvent","斗地主直播间","下载跳转量","主播头像",0,"_29sAuthor"]);CommonAPP.openApp()};var l=document.createElement("a");l.className="vjs-29sRightSide-download";l.innerHTML="下载大圣Live 与她更多互动";c.appendChild(l)}this.on("play",function(){if(z){}});this.on("timeupdate",function(){if(z&&_29sTime){var B=Math.ceil(_29sTotalTime-this.currentTime());if(B<1){_29sTime.style.display="none";return}else{_29sTime.style.display="block"}_29sTime.innerHTML=_29sTotalTime>=10?'<img src="./images/number/'+Math.floor(B/10)+'.png" alt=""><img src="./images/number/'+Math.floor(B%10)+'.png" alt="">':'<img src="./images/number/0.png" alt=""><img src="./images/number/'+B+'.png" alt="">'}if(v.status==0){}});this.on("ended",function(){if(z){_29sTime.style.display="block";_29sTime.innerHTML='<img src="./images/number/2.png" alt=""><img src="./images/number/9.png" alt="">';if(v._29s.today_pk_video){$(".mask").addClass("m-5");$(".support").on("click",function(B){B.stopPropagation();$.ajax({url:mainUrl+pkApiUrl.vote,type:"GET",data:{video_id:v.objectId,uin:uin},dataType:"json",success:function(C){if(C.code==0){CommonJS.Toast("支持成功");$(".mask").removeClass("m-5")}else{CommonJS.Toast(C.msg);$(".mask").removeClass("m-5")}},error:function(C){CommonJS.Toast(C);$(".mask").removeClass("m-5")}})});$(".mask").on("click",function(){$(this).removeClass("m-5")})}}})})}}})();var has_un_token=0;if(localStorage.im_token!=undefined&&localStorage.im_token!="undefined"&&localStorage.im_token){has_un_token=1}$.ajax({url:mainUrl+ddzUrl.info,type:"GET",data:{chatroom_id:v.objectId,has_im_token:has_un_token},dataType:"json",success:function(a){console.log(a);var b=a.data;v.status=b.status;v.objectId=b.chatroom_id;v.title=b.title;v.playUrl=CommonJS.RemoveProtocol(b.url);v.poster=b.cover;v.im_token=b.im_token;if(localStorage.im_token!=undefined&&localStorage.im_token!="undefined"&&localStorage.im_token){v.im_token=localStorage.im_token}else{v.im_token=b.im_token;localStorage.im_token=b.im_token}v._29s=false;if(b.type!=undefined&&b.type=="normal_29s"){v._29s={type:"normal",topic:b.topic,drama:b.drama,avator:b.avator,nick:b.nick||"大圣用户",uid:b.uid||"暂无",recommend_list:b.recommend_list,today_pk_video:b.today_pk_video||0};if(v._29s.today_pk_video){$.ajax({url:mainUrl+ddzUrl.watch,type:"GET",data:{video_id:v.objectId,uin:uin},dataType:"json",success:function(c){}})}}if(b.status==1){myPreload.loadManifest(manifest)}document.getElementsByTagName("meta")[7].setAttribute("content",v.title);myVideo=new Video();myVideo.init()},error:function(){if(error.status!==0){CommonJS.Toast("视频接口异常")}else{CommonJS.Toast("请刷新重试")}}});function _29sAbout(e,d){var a=document.documentElement.clientHeight/3*0.75;var c="";for(var b=0;b<d.length;b++){c+='<div class="vjs-29sLeftSide-item"><a href="./live.html?videoId='+d[b].chatroom_id+'" style="width: '+a+'px"><i style="background-image: url('+d[b].cover+')"></i><b><span><strong>#</strong>'+d[b].topic+"</span><span><em>"+d[b].viewer_num+"</em></span></b></a></div>"}$(e).append(c)}(function(){window.Danmu=function(b,a){this._element=b};Danmu.prototype={getPath:function(){var a=Math.floor(Math.random()*5)+1;var b="linear";switch(a){case 1:b="linear";break;case 2:b="ease";break;case 3:b="ease-in";break;case 4:b="ease-out";break;case 5:b="ease-in-out";break;default:b="linear";break}return b},getTop:function(){var a=document.getElementsByClassName("dd-item-1").length;var b=document.getElementsByClassName("dd-item-2").length;var c=document.getElementsByClassName("dd-item-3").length;if(a===0||a<=b&&a<=c){return 1}else{if(b===0||b<a&&b<=c){return 2}else{return 3}}},addDanmu:function(g,d){var e=this.getTop();var c=document.createElement("div");c.className="dd-item dd-item-"+e;CommonJS.SetStyle(c,{top:(e-1)*0.52+"rem",animationTimingFunction:this.getPath(),webkitAnimationTimingFunction:this.getPath()});var a=document.createElement("b");a.innerHTML=d;c.appendChild(a);var f=document.createElement("span");f.innerHTML=g;c.appendChild(f);this._element.appendChild(c);this.removeDanmu(c)},removeDanmu:function(c){var a=this;var b=CommonJS.WhichTransitionEvent("animation");if(b){c.addEventListener(b,function(){c.parentNode.removeChild(c)})}}}})();(function(){window.Zan=function(a){this.obj=a};Zan.prototype={getPath:function(){var a=Math.floor(Math.random()*5)+1;var b="linear";switch(a){case 1:b="linear";break;case 2:b="ease";break;case 3:b="ease-in";break;case 4:b="ease-out";break;case 5:b="ease-in-out";break}return b},getType:function(){return Math.floor(Math.random()*5)+1},getName:function(){return Math.floor(Math.random()*2)===1?"_moveX":"moveX"},creatZan:function(){var a=document.createElement("div");a.className="zan_item zan"+this.getType();a.style.webkitAnimationName=this.getName();a.style.animationName=this.getName();a.style.webkitAnimationTimingFunction=this.getPath();a.style.animationTimingFunction=this.getPath();a.style.opacity=(Math.floor(Math.random()*6)+5)/10;return a},removeObj:function(c){var a=CommonJS.WhichTransitionEvent("animation");var b=false;if(a){c.addEventListener(a,function(){if(b){return}c.parentNode.removeChild(c);b=true})}},init:function(){var a=this.creatZan();this.obj.appendChild(a);this.removeObj(a)}}})();(function(){window.Gift=function(a){this.$element=$(a);this.queueNum=0;this.nextQueue=[];this.leftGiftQueue=[];this.avatar="/Vss/images/share_1_4/header.jpg";this.name="大圣Live用户";this.giftName="";this.bundleNum=1;this.giftImage="";this.giftImageGifUrl="";this.type="type";this.uid=1};Gift.prototype={init:function(){this.popGift()},popGift:function(){var a=this;setInterval(function(){if(a.nextQueue.length===0){return}if(a.queueNum<2||a.checkSameUser(a.nextQueue[0].name,a.nextQueue[0].uid)!==null){avatar=a.nextQueue[0].avatar;name=a.nextQueue[0].name;giftName=a.nextQueue[0].giftName;giftImage=a.nextQueue[0].giftImage;giftId=a.nextQueue[0].uid;giftImageGifUrl=a.nextQueue[0].giftImageGifUrl;a.addGift(a.nextQueue[0]);a.nextQueue.splice(0,1)}},150)},checkSameUser:function(a){var b=null;this.$element.find(".gift").each(function(c,d){if($(d).attr("data-name")===a.name&&parseInt($(d).attr("data-uid"))===a.uid){b=$(d)}});return b},addGift:function(d){d.avatar=typeof d.avatar!=="undefined"?d.avatar:this.avatar;d.name=typeof d.name!=="undefined"?d.name:this.name;d.bundleNum=typeof d.bundleNum!=="undefined"?d.bundleNum:this.bundleNum;d.giftName=typeof d.giftName!=="undefined"?d.giftName:this.giftName;d.giftImage=typeof d.giftImage!=="undefined"?d.giftImage:this.giftImage;d.giftImageGifUrl=typeof d.giftImageGifUrl!=="undefined"?d.giftImageGifUrl:this.giftImageGifUrl;d.type=typeof d.type!=="undefined"?d.type:this.type;d.uid=typeof d.uid!=="undefined"?d.uid:this.uid;var e=this.checkSameUser(d);if(e!==null){this.$element.data("gift_"+d.uid+"_time",0);var a=e.find("b");var f=parseInt(a.text())+1;if(f>=100){a.parent().addClass("_100")}else{if(f>=50){a.parent().addClass("_50")}else{if(f>=20){a.parent().addClass("_20")}else{}}}a.html(f);a.addClass("numBounceIn");var c=CommonJS.WhichTransitionEvent("animation");if(c){a[0].addEventListener(c,function(){a.removeClass("numBounceIn")})}}else{if(this.queueNum<2){this.createGift(d)}else{this.nextQueue.push(d)}}},createGift:function(a){var g=document.createElement("div");g.className="gift";if(a.type=="fill"){g.classList.add("fill")}g.setAttribute("data-name",a.name);g.setAttribute("data-uid",a.uid);var n=document.createElement("table");g.appendChild(n);var k=document.createElement("tr");n.appendChild(k);var e=document.createElement("td");k.appendChild(e);var h=document.createElement("i");h.style.backgroundImage="url("+a.avatar+")";e.appendChild(h);var e=document.createElement("td");k.appendChild(e);var c=document.createElement("em");c.innerHTML=a.name;e.appendChild(c);var d=document.createElement("cite");d.innerHTML="送出 <span>"+a.bundleNum+"</span>个"+a.giftName;e.appendChild(d);var e=document.createElement("td");k.appendChild(e);var f=document.createElement("img");f.src=a.giftImage;e.appendChild(f);var e=document.createElement("td");k.appendChild(e);var m=document.createElement("strong");m.innerHTML="×";e.appendChild(m);var l=document.createElement("b");l.innerHTML="1";e.appendChild(l);var j=document.createElement("img");$(j).addClass("giftImageGif");$(j).attr("src",a.giftImageGifUrl);if(a.type=="fill"){$(j).css({display:"block","max-width":"80%","max-height":"80%",position:"fixed",left:"50%",top:"50%","-webkit-transform":"translate3d(-50%,-50%,0)",transform:"translate3d(-50%,-50%,0)","z-index":10001})}else{$(j).css({opacity:0,width:"2.4rem","margin-bottom":"-0.3rem","margin-left":"1rem",display:"none"})}this.sendGift(a,g,j)},sendGift:function(b,c,a){this.$element.prepend($(c));if(b.type=="fill"){$("body").prepend($(a))}else{this.$element.prepend($(a))}$(a).addClass("giftFadeIn");this.leftGiftQueue.push(a);if(this.queueNum>0){$(this.leftGiftQueue[0]).css({visibility:"hidden",display:"none"});this.leftGiftQueue.splice(0,1)}c.classList.add("giftIn");this.$element.data("gift_"+b.uid+"_time",0);this.queueNum+=1;this.countDown($(c),a,b)},countDown:function(d,a,c){var b=this;var e=setInterval(function(){var f="gift_"+c.uid+"_time";b.$element.data(f,parseInt(b.$element.data(f))+33);if(parseInt(b.$element.data(f))>=3000){d[0].classList.add("giftOut");a.classList.remove("giftFadeIn");b.giftEnd(d[0],a,c);clearInterval(e)}},33)},giftEnd:function(e,a,d){var c=this;var b=CommonJS.WhichTransitionEvent("animation");b&&e.addEventListener(b,function(){e.parentNode.removeChild(e);a?a.parentNode.removeChild(a):false;c.$element.data("gift_"+d.uid+"_time",0);for(var f=0;f<c.leftGiftQueue.length;f++){if(c.leftGiftQueue[f]==a){c.leftGiftQueue.splice(f,1);break}}c.queueNum-=1})}}})();(function(){window.TextData=function(){this.index=0;this.commentQueue=[];this.queue=-1};TextData.prototype={init:function(a){if(Math.floor(a/300)!=this.queue){this.queue=Math.floor(a/300);this.index=this.queue;this.getZip()}else{}},getZip:function(){var a=this;$.ajax({url:"//dasheng.test.appgame.com/share/getDanmuUrlByIndex",type:"POST",data:{videoId:v.objectId,index:a.index},dataType:"json",success:function(b){if(b.error===1){console.log(b.msg)}else{a.getData(b.data.url)}a.index+=1},error:function(b){console.log(b)}})},getData:function(a){var b=this;b.commentQueue.splice(0,b.commentQueue.length);$.ajax({url:"//dasheng.test.appgame.com/share/ajaxGetDanmu",type:"GET",data:{danmu_url:a,create_time:create_time},dataType:"json",timeout:3000,success:function(c){var f=c.data;for(var e=0;e<f.length;e++){if(f[e].content._lctype==21){}else{if(f[e].content._lctype==-1){var d={time:f[e].time,avatar:f[e].content._lcattrs.avatar,nickname:f[e].content._lcattrs.nickname,_lctext:f[e].content._lctext};b.commentQueue.push(d)}}}}})}}})();(function(){window.Vote=function(){this.voted=false;this.container=null;this.voteBtn=null;this.totalTime=0;this.voteId=0};Vote.prototype={create:function(c,b){var a=this;a.voteBtn=a.createButton(c);setTimeout(function(){a.voteBtn.parentNode.classList.add("stretch")},100);a.container=a.createContainer(c,b);a.createEvent();if(b.vote_type==1){a.countDown()}a.voted=true},init:function(c,b){var a=this;if(b.status==4){this.end(b)}else{if(a.voted){a.update(b)}else{if(a.voteId!=0&&a.voteId!=b.vote_id){if(a.voteBtn!=null&&a.voteBtn.parentNode.className.match(new RegExp("(\\s|^)stretch(\\s|$)"))){a.voteBtn.parentNode.classList.remove("stretch")}if(a.container!=null&&a.container.voteBody.className.match(new RegExp("(\\s|^)stretch(\\s|$)"))){a.container.voteBody.classList.remove("stretch")}setTimeout(function(){if(a.voteBtn!=null){a.voteBtn.parentNode.parentNode.removeChild(a.voteBtn.parentNode)}if(a.container!=null){a.container.voteBody.parentNode.removeChild(a.container.voteBody)}a.create(c,b)},300)}else{a.create(c,b)}a.voted=true}}},createEvent:function(){var a=this;a.voteBtn.onclick=function(){a.voteBtn.parentNode.classList.remove("stretch");a.container.voteBody.classList.add("stretch")};a.container.voteBody.onclick=function(){downloadType="投票组件";document.getElementsByClassName("mask")[0].classList.add("m-1")};a.container.voteClose.onclick=function(b){b.stopPropagation();a.container.voteBody.classList.remove("stretch");if(a.container.voteBody.className.match(new RegExp("(\\s|^)end(\\s|$)"))){setTimeout(function(){a.container.voteBody.parentNode.removeChild(a.container.voteBody);a.voteBtn.parentNode.parentNode.removeChild(a.voteBtn.parentNode);a.voteBtn=null;a.container=null},300)}else{a.voteBtn.parentNode.classList.add("stretch")}}},createButton:function(c){var a=document.createElement("div");a.className="vjs-vote-button";c.appendChild(a);var b=document.createElement("a");a.appendChild(b);return b},createContainer:function(o,c){var h=document.createElement("div");h.className="vjs-container-vote";h.id="vote_"+c.vote_id;this.voteId=c.vote_id;h.classList.add("vjs-container-item-"+c.vote_option.length);o.appendChild(h);var s=document.createElement("a");s.className="vjs-vote-close";h.appendChild(s);var l=document.createElement("div");l.className="vjs-vote-subTitle";l.innerHTML="投票";h.appendChild(l);var d=document.createElement("div");d.className="vjs-vote-pubTitle";if(c.vote_type!=1){d.classList.add("pd29")}d.innerHTML=c.name;h.appendChild(d);if(c.vote_type==1){var n=document.createElement("div");n.className="vjs-vote-countTime";n.innerHTML=this.toTime(c.count_down);h.appendChild(n);this.totalTime=c.count_down}var k=document.createElement("ul");h.appendChild(k);var j=[],e=[],g=[];for(var r=0;r<c.vote_option.length;r++){j[r]=document.createElement("li");k.appendChild(j[r]);e[r]=document.createElement("p");e[r].innerHTML=c.vote_option[r].name;j[r].appendChild(e[r]);g[r]=document.createElement("i");g[r].innerHTML=c.vote_option[r].vote_count;j[r].appendChild(g[r])}var b=document.createElement("div");b.className="vjs-vote-rankTitle";b.innerHTML="贡献榜";h.appendChild(b);var q=document.createElement("dl");h.appendChild(q);var m=[],f=[],a=[];for(var r=0;r<c.top_user.length;r++){m[r]=document.createElement("dt");m[r].setAttribute("uid",c.top_user[r].uid);q.appendChild(m[r]);f[r]=document.createElement("i");var t=document.createElement("img");t.src=c.top_user[r].photo_url;t.onload=function(){f[r].style.backgroundImage="url("+c.top_user[r].photo_url+")"};t.onerror=function(){f[r].style.backgroundImage="url(./images/hall/header.jpg)"};m[r].appendChild(f[r]);a[r]=document.createElement("p");a[r].innerHTML=this.toCount(c.top_user[r].top_count);m[r].appendChild(a[r])}for(var r=c.top_user.length;r<3;r++){m[r]=document.createElement("dt");q.appendChild(m[r]);f[r]=document.createElement("i");f[r].style.backgroundImage="url(./images/vote/mask@2x.png)";m[r].appendChild(f[r]);a[r]=document.createElement("p");a[r].innerHTML="抢占";m[r].appendChild(a[r])}return{voteClose:s,voteBody:h,items:k,voteNum:g,topUser:{avatar:f,count:a},countTime:n,subTitle:l}},update:function(d){var a=this.container.voteNum;var e=this.container.topUser;for(var c=0;c<d.vote_option.length;c++){a[c].innerHTML=d.vote_option[c].vote_count}for(var c=0;c<d.top_user.length;c++){var b=document.createElement("img");b.src=d.top_user[c].avatar;b.onload=function(){e.avatar[c].style.backgroundImage="url("+d.top_user[c].avatar+")"};b.onerror=function(){e.avatar[c].style.backgroundImage="url(./images/hall/header.jpg)"};e.count[c].innerHTML=this.toCount(d.top_user[c].top_count)}},end:function(c){var a=this;if(c.ans_option_id==0&&c.result[0]==0){return}if(!a.voted){a.init(c)}else{a.update(c)}a.voteBtn.parentNode.classList.add("end");a.container.voteBody.classList.add("end");if(c.ans_option_id==0){a.container.voteBody.classList.add("end-1");for(var b=0;b<c.result.length;b++){a.container.voteBody.classList.add("ans-"+c.result[b])}}else{a.container.voteBody.classList.add("end-2");a.container.voteBody.classList.add("ans-"+c.ans_option_id)}a.container.subTitle.innerHTML="结果";a.voted=false},toTime:function(b){var b=parseInt(b),d=0,a=0,c=0;d=Math.floor(b/60/60);a=Math.floor(b/60)%60;c=b%60;d=d>0?(d>9?d:"0"+d):0;a=a>0?(a>9?a:"0"+a):"00";c=c>0?(c>9?c:"0"+c):"00";if(d!=0){return d+":"+a+":"+c}else{return a+":"+c}},toCount:function(a){var a=parseInt(a);if(a>10000){a=(a/10000).toFixed(1)+"W"}else{if(a>1000){a=(a/1000).toFixed(1)+"K"}}return a},countDown:function(){var a=this;setInterval(function(){if(a.totalTime==0){return}a.totalTime--;a.container.countTime.innerHTML=a.toTime(a.totalTime)},1000)}}})();var myVote=new Vote();(function(){window.Lottery=function(){this.lotteryStatus=[0,0,0,0];this.container=null;this.lotteryBtn=null;this.lotteryId=0};Lottery.prototype={create:function(c,b){var a=this;a.createButton(c,b);setTimeout(function(){a.lotteryBtn.classList.add("stretch")},100);a.container=a.createContainer(c,b);a.createEvent()},init:function(c,b){var a=this;if(!a.lotteryStatus[0]){a.create(c,b)}else{if(b.result_data){if(!a.lotteryStatus[2]){a.end(b.result_data)}}else{if(b.stages==4){if(a.lotteryStatus[0]){a.destroy()}}else{if(b.stages==3){if(!a.lotteryStatus[1]){a.lottery(a.container.label,a.container.lotteryBody,a.container.join)}}else{if(b.stages==2){a.wait(a.container.label,a.container.lotteryBody,a.container.join)}}}}}},createEvent:function(){var a=this;a.lotteryBtn.onclick=function(){a.lotteryBtn.classList.remove("stretch");a.container.lotteryBody.classList.add("stretch")};a.container.lotteryBody.onclick=function(b){b.stopPropagation();document.getElementsByClassName("mask")[0].classList.add("m-1")};a.container.lotteryClose.onclick=function(b){b.stopPropagation();a.container.lotteryBody.classList.remove("stretch");if(a.container.lotteryBody.className.match(new RegExp("(\\s|^)end(\\s|$)"))){setTimeout(function(){a.container.lotteryBody.parentNode.removeChild(a.container.lotteryBody);a.lotteryBtn.parentNode.removeChild(a.lotteryBtn);a.lotteryBtn=null;a.container=null;a.lotteryStatus=[0,0,0,0];a.lotteryId=0},300)}else{a.lotteryBtn.classList.add("stretch")}}},createButton:function(c,b){var a=document.createElement("div");a.className="vjs-lottery-button";if(b.result_data){a.innerHTML="中奖结果"}else{if(b.stages==2){a.innerHTML="等待抽奖"}else{if(b.stages==3){a.innerHTML="正在抽奖"}else{a.innerHTML="点击参加"}}}c.appendChild(a);this.lotteryBtn=a;return a},createContainer:function(c,d){this.lotteryStatus[0]=1;var j=["diamond","gold","total"];var b=document.createElement("div");b.className="vjs-container-lottery";b.id="lottery_"+d.lottery_id;this.lotteryId=d.lottery_id;b.classList.add("vjs-container-lottery-"+j[d.type-1]);c.appendChild(b);var f=document.createElement("div");f.className="vjs-lottery-body";b.appendChild(f);var a=document.createElement("a");a.className="vjs-lottery-close";a.innerHTML="收起";f.appendChild(a);var g=document.createElement("h3");g.innerHTML=d.title;f.appendChild(g);var h=document.createElement("label");f.appendChild(h);var e=null;if(d.stages==1){e=document.createElement("a");e.className="vjs-lottery-join";e.innerHTML="点击参与";f.appendChild(e)}var k=null;if(d.stages==2){b.classList.add("lottery-status-lotterying");h.innerHTML="<span>等待抽奖</span>"}else{if(d.stages==3){b.classList.add("lottery-status-lotterying");if(d.result_data){h.innerHTML="<span>中奖结果</span>";k=this.createOwner(b,d.result_data)}else{this.lottery(h,lotteryBody,e)}}else{if(d.type==1||d.type==2){h.innerHTML="<span>消耗"+d.price+"</span><span>"+(d.type==1?"钻石":"大圣币")+"</span>"}else{h.innerHTML="<span>0消耗</span><span>参与</span>"}}}return{lotteryBody:b,lotteryClose:a,label:h,join:e,pull:k}},createOwner:function(h,e){var a=document.createElement("div");a.className="vjs-lottery-owner";h.appendChild(a);var g=null;var c=document.createElement("div");c.className="avatar";a.appendChild(c);var b=document.createElement("img");b.src=e.photo_url;b.onload=function(){d.style.backgroundImage="url("+e.photo_url+")"};b.onerror=function(){d.style.backgroundImage="url(./images/lottery/header.jpg)"};var d=document.createElement("i");c.appendChild(d);var b=document.createElement("img");b.src="./images/lottery/ticket@2x.png";c.appendChild(b);var h=document.createElement("p");h.innerHTML=e.nick+"<br>@"+e.uid;a.appendChild(h);var f=document.createElement("span");f.innerHTML=e.win_content;a.appendChild(f);this.lotteryStatus[2]=1;return g},lottery:function(b,a,c){this.lotteryBtn.innerHTML="开始抽奖";b.innerHTML="<span>抽奖中...</span>";a.classList.add("lottery-status-lotterying");if(c!=null){c.parentNode.removeChild(c);this.container.join=null}this.lotteryStatus[1]=1},wait:function(b,a,c){this.lotteryBtn.innerHTML="等待抽奖";b.innerHTML="<span>等待抽奖</span>";a.classList.add("lottery-status-lotterying");if(c!=null){c.parentNode.removeChild(c);this.container.join=null}},end:function(a){this.container.lotteryBody.classList.add("end");this.lotteryBtn.innerHTML="中奖结果";this.container.lotteryBody.classList.add("lottery-status-lotterying");this.container.label.innerHTML="中奖结果";if(this.container.join){this.container.join.parentNode.removeChild(this.container.join)}this.createOwner(this.container.lotteryBody,a)},close:function(){var a=this;if(a.lotteryBtn){if(a.lotteryBtn.className.match(new RegExp("(\\s|^)stretch(\\s|$)"))){a.lotteryBtn.classList.remove("stretch")}setTimeout(function(){a.lotteryBtn.parentNode.removeChild(a.lotteryBtn);a.lotteryBtn=null},300)}if(a.container.lotteryBody){if(a.container.lotteryBody.className.match(new RegExp("(\\s|^)stretch(\\s|$)"))){a.container.lotteryBody.classList.remove("stretch")}setTimeout(function(){a.container.lotteryBody.parentNode.removeChild(a.container.lotteryBody);a.container=null},300)}a.lotteryStatus=[0,0,0,0];a.lotteryId=0},destroy:function(){var a=this;if(a.container.lotteryBody.className.match(new RegExp("(\\s|^)stretch(\\s|$)"))){a.container.lotteryBody.classList.remove("stretch")}if(a.lotteryBtn.className.match(new RegExp("(\\s|^)stretch(\\s|$)"))){a.lotteryBtn.classList.remove("stretch")}setTimeout(function(){a.container.lotteryBody.parentNode.removeChild(a.container.lotteryBody);a.lotteryBtn.parentNode.removeChild(a.lotteryBtn);a.lotteryBtn=null;a.container=null;a.lotteryStatus=[0,0,0,0];a.lotteryId=0},300)}}})();var myLottery=new Lottery();(function(){window.Punishment=function(){this.punishmented=false;this.container=null;this.totalTime=0;this.punishmentId=0;this.finish=false;this.w1=50;this.w2=50};Punishment.prototype={create:function(c,b){var a=this;a.container=a.createContainer(c,b);setTimeout(function(){a.container.body.classList.add("stretch")},100);a.countDown();this.punishmented=true},init:function(c,b){var a=this;if(a.punishmented){if(b.status==1){a.update(b)}else{a.end(b)}}else{if(b.status==1){a.create(c,b)}}},createContainer:function(o,b){var k=document.createElement("div");k.className="vjs-container-punishment";k.id="punishment_"+b.punishment_id;this.punishmentId=b.punishment_id;o.appendChild(k);var x=document.createElement("div");x.className="vjs-punishment-title";x.innerHTML=b.title;k.appendChild(x);var j=document.createElement("div");j.className="vjs-punishment-tips tips_left";k.appendChild(j);var l=document.createElement("span");l.innerHTML=b.user.u1.nick;j.appendChild(l);var q=document.createElement("span");if(parseInt(b.user.u1.total)!=0){q.innerHTML=b.user.u1.total}j.appendChild(q);var w=document.createElement("div");w.className="vjs-punishment-tips tips_right";k.appendChild(w);var m=document.createElement("span");m.innerHTML=b.user.u2.nick;w.appendChild(m);var r=document.createElement("span");if(parseInt(b.user.u2.total)!=0){r.innerHTML=b.user.u2.total}w.appendChild(r);var s="50%",c="50%";if(parseInt(b.score[1])+parseInt(b.score[0])!=0){s=parseInt(b.score[1])/(parseInt(b.score[1])+parseInt(b.score[0]))*100+"%";c=parseInt(b.score[0])/(parseInt(b.score[1])+parseInt(b.score[0]))*100+"%"}var e=document.createElement("div");e.className="vjs-punishment-lineText";k.appendChild(e);var u=document.createElement("span");u.className="line line_left";u.style.width=s;e.appendChild(u);var n=document.createElement("span");n.className="line line_right";n.style.width=c;e.appendChild(n);var a=document.createElement("span");a.className="text text_left";a.innerHTML=b.score[1]||0+"票";e.appendChild(a);var g=document.createElement("span");g.className="text text_right";g.innerHTML=b.score[0]||0+"票";e.appendChild(g);var d=document.createElement("div");d.className="vjs-punishment-consume consume_left";d.innerHTML='<span class="diamond">1<b>送小刀</b></span>';k.appendChild(d);var t=document.createElement("div");t.className="vjs-punishment-consume consume_right";t.innerHTML='<span class="diamond"><b>送护盾</b>1</span>';k.appendChild(t);var f=document.createElement("div");f.className="vjs-punishment-time";f.innerHTML="距结束";k.appendChild(f);var h=document.createElement("span");h.innerHTML=this.toTime(b.count_down);this.totalTime=b.count_down;f.appendChild(h);k.onclick=function(){downloadType="惩罚组件";document.getElementsByClassName("mask")[0].classList.add("m-1")};return{body:k,u1_nick:l,u1_count:q,u2_nick:m,u2_count:r,text_left:a,text_right:g,line_left:u,line_right:n,consume_left:d,consume_right:t,countTime:h}},update:function(a){this.container.u1_nick.innerHTML=a.user.u1.nick;if(parseInt(a.user.u1.total)!=0){this.container.u1_count.innerHTML=a.user.u1.total}this.container.u2_nick.innerHTML=a.user.u2.nick;if(parseInt(a.user.u2.total)!=0){this.container.u2_count.innerHTML=a.user.u2.total}this.container.text_left.innerHTML=a.score[1]+"票";this.container.text_right.innerHTML=a.score[0]+"票";var b="50%",c="50%";if(parseInt(a.score[1])+parseInt(a.score[0])){b=parseInt(a.score[1])/(parseInt(a.score[1])+parseInt(a.score[0]))*100+"%";c=parseInt(a.score[0])/(parseInt(a.score[1])+parseInt(a.score[0]))*100+"%"}this.container.line_left.style.width=b;this.container.line_right.style.width=c},move:function(){var a=this;var b=-1;setInterval(function(){if(a.finish){return}if(a.w1==48){b=1}if(a.w1==52){b=-1}if(a.w1>45&&b==-1){a.w1-=1;a.w2+=1}else{a.w1+=1;a.w2-=1}a.container.line_left.style.width=a.w1+"%";a.container.line_right.style.width=a.w2+"%"},100)},add:function(){var a=this;setTimeout(function(){a.container.consume_left.classList.add("add");a.remove(a.container.consume_left);a.container.consume_right.classList.add("add");a.remove(a.container.consume_right)},2000)},remove:function(c){var b=this;var a=CommonJS.WhichTransitionEvent("animation");a&&c.addEventListener(a,function(){c.classList.remove("add");b.add()})},end:function(a){this.punishmented=false;this.w1=50;this.w2=50;this.finish=true;this.container.body.parentNode.removeChild(this.container.body);if(a.score[0]>a.score[1]){this.result(1)}else{if(a.score[0]==a.score[1]){this.result(2)}else{this.result(3)}}},result:function(c){var a=document.createElement("div");a.className="punishment-mask";document.getElementsByTagName("body")[0].appendChild(a);var b=document.createElement("img");switch(c){case 1:b.src="./images/punishment/sucess.png";break;case 2:b.src="./images/punishment/eq.png";break;case 3:b.src="./images/punishment/fail.png";break}a.appendChild(b);a.onclick=function(){a.parentNode.removeChild(a)}},toTime:function(b){var b=parseInt(b),d=0,a=0,c=0;d=Math.floor(b/60/60);a=Math.floor(b/60)%60;c=b%60;d=d>0?(d>9?d:"0"+d):0;a=a>0?(a>9?a:"0"+a):"00";c=c>0?(c>9?c:"0"+c):"00";return a+":"+c},countDown:function(){var a=this;setInterval(function(){if(a.totalTime==0){return}a.totalTime--;a.container.countTime.innerHTML=a.toTime(a.totalTime)},1000)}}})();var myPunishment=new Punishment();var myDialog=new Dialog();_x5enter=false;var listenX5Video=function(){myVideo._video.addEventListener("x5videoenterfullscreen",function(){_x5enter=true;$("#video").addClass("vjs-x5");$(".main").addClass("x5")});myVideo._video.addEventListener("x5videoexitfullscreen",function(){_x5enter=false;$("#video").removeClass("vjs-x5");$(".main").removeClass("x5");myVideo._video.style.width="100%";myVideo._video.style.height="100%";if(!v._29s){playBtn.classList.add("paused")}})};window.addEventListener("resize",function(){myVideo._video.style["object-position"]="50% 50%";if(_x5enter){myVideo._video.style.width=CommonJS.ScreenWidth()+"px";myVideo._video.style.height=CommonJS.ScreenHeight()+"px"}if(v._29s){_29sContent.style.width=544/960*document.documentElement.clientHeight+"px";$(".vjs-29sLeftSide-item a").css("width",document.documentElement.clientHeight/3*0.75+"px")}},false);$(document).delegate(".vjs-control-commentList a","click",function(){$(commentList).removeClass("show");sendComment($(this).text())});var downloadType="";$(document).delegate(".d1 .button","click",function(){CommonAPP.openApp()});$(".close").on("click",function(){$(".mask").removeClass("m-1")});if(CommonJS.GetQueryString("compatibleVersion")&&CommonJS.GetQueryString("compatibleVersion")==1||localStorage.compatibleVersion==1){localStorage.compatibleVersion==1}$(document).delegate(".downloadBtn","click",function(){CommonAPP.openApp();_hmt.push(["_trackEvent","斗地主直播间-播放页","点击","普通视频导量",1]);_czc.push(["_trackEvent","斗地主直播间-播放页","普通视频导量","点击",0,"download"])});$(document).delegate(".vjs-29sRightSide-download","click",function(){CommonAPP.openApp();_hmt.push(["_trackEvent","斗地主直播间-播放页","点击","29s导量",1]);_czc.push(["_trackEvent","斗地主直播间-播放页","29s导量","点击",0,"download"])});$(document).delegate(".vjs-29sLeftSide a","click",function(){_hmt.push(["_trackEvent","斗地主直播间-播放页","点击","推荐视频",1]);_czc.push(["_trackEvent","斗地主直播间-播放页","推荐视频","点击",0,"video"])});